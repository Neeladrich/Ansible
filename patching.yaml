---
- name: os patching
  hosts: all
  become: yes

  tasks:
    - name: List listening ports and save to file
      command: netstat -lutnp
      register: port_output

    - name: Save listening ports to file
      copy:
        content: "{{ port_output.stdout }}"
        dest: /tmp/listening_ports.txt
        owner: root
        group: root
        mode: '0644'
      
    - name: latest updates 
      yum:
        name: "*"
        state: latest

    - name: install httpd
      yum:
          name: httpd
          state: present

    - name: service restart
      service:
        name: httpd
        state: restarted
        enabled: yes